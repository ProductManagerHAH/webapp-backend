/*!
 * name: @jswork/next-fs-open
 * description: Open/read file from local or remote.
 * homepage: https://github.com/afeiship/next-fs-open
 * version: 1.0.4
 * date: 2021-08-31 09:12:12
 * license: MIT
 */

(function () {
  var global = typeof window !== 'undefined' ? window : this || Function('return this')();
  var nx = global.nx || require('@jswork/next');
  var fetch = require('node-fetch');
  var isValidUrl = require('@jswork/is-valid-url').default;
  var fs = require('fs');
  var util = require('util');
  var fromFile = util.promisify(fs.readFile);

  var NxFsOpen = nx.declare('nx.FsOpen', {
    statics: {
      fromFile,
      fromUrl: function (inUrl) {
        return fetch(inUrl).then((r) => r.buffer());
      },
      from: function (inTarget) {
        if (Buffer.isBuffer(inTarget)) return Promise.resolve(inTarget);
        var valid = isValidUrl(inTarget);
        var api = valid ? 'fromUrl' : 'fromFile';
        return this[api](inTarget);
      }
    }
  });

  if (typeof module !== 'undefined' && module.exports) {
    module.exports = NxFsOpen;
  }
})();
